<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Checkout — Little Sprouts</title>
<style>
  :root{--card:#fff;--muted:#6b7280;--accent:#ff7aa2;--shadow:0 8px 24px rgba(16,24,40,0.06)}
  *{box-sizing:border-box;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;}
  body{margin:0;background:#f6fbff;color:#0f172a}
  header{padding:18px 6%;display:flex;justify-content:space-between;align-items:center}
  .container{padding:18px 6%}
  .layout{display:grid;grid-template-columns:1fr 360px;gap:20px}
  .card{background:var(--card);padding:16px;border-radius:12px;box-shadow:var(--shadow)}
  h2{margin-top:0}
  .cart-item{display:flex;gap:12px;align-items:center;border-bottom:1px dashed #eef6ff;padding:12px 0}
  .cart-item img{width:72px;height:72px;object-fit:cover;border-radius:8px}
  .muted{color:var(--muted);font-size:13px}
  label{display:block;font-weight:700;margin-top:10px;font-size:13px}
  input,select,textarea{width:100%;padding:10px;margin-top:6px;border-radius:8px;border:1px solid #e6eef8}
  .small{font-size:13px;color:var(--muted)}
  .totals{display:flex;flex-direction:column;gap:8px;margin-top:12px}
  .totals .row{display:flex;justify-content:space-between}
  .btn{background:var(--accent);color:#fff;border:none;padding:12px;border-radius:10px;cursor:pointer;font-weight:800;width:100%}
  .secondary{background:transparent;border:1px solid #e6eef8;color:var(--muted);padding:10px;border-radius:10px;cursor:pointer}
  @media(max-width:900px){.layout{grid-template-columns:1fr}}
</style>
</head>
<body>
<header>
  <div style="font-weight:800">Checkout — Little Sprouts</div>
  <div>
    <a href="index.html" style="color:var(--muted);text-decoration:none;margin-right:12px">Home</a>
    <a href="products.html" style="color:var(--muted);text-decoration:none">Products</a>
  </div>
</header>

<div class="container">
  <div class="layout">
    <div>
      <div class="card" id="cartCard">
        <h2>Cart Summary</h2>
        <div id="cartList" class="small muted">Loading cart...</div>
        <div style="margin-top:12px;display:flex;gap:8px">
          <button class="secondary" onclick="continueShopping()">Continue Shopping</button>
          <button class="secondary" onclick="clearCart()">Clear Cart</button>
        </div>
      </div>

      <div class="card" style="margin-top:16px">
        <h2>Shipping & Billing</h2>
        <form id="orderForm" onsubmit="placeOrder(event)">
          <label>Full Name<input id="name" required></label>
          <label>Email<input id="email" type="email" required></label>
          <label>Phone<input id="phone" required></label>
          <label>Address<textarea id="address" rows="3" required></textarea></label>
          <label>City<input id="city" required></label>
          <label>State<input id="state" required></label>
          <label>Postal Code<input id="zip" required></label>
          <label>Apply Coupon (optional)<input id="coupon" placeholder="e.g. FIRST10"></label>
          <div style="margin-top:10px" class="small muted">We accept Credit/Debit, UPI & PayPal</div>

          <label style="margin-top:12px">Payment Method
            <select id="paymentMethod" required onchange="onPaymentChange()">
              <option value="card">Credit / Debit Card</option>
              <option value="upi">UPI</option>
              <option value="paypal">PayPal</option>
            </select>
          </label>

          <div id="paymentFields" style="margin-top:8px">
            <!-- dynamic -->
            <div id="cardFields">
              <label>Card Number<input id="cardNumber" placeholder="1234 1234 1234 1234"></label>
              <div style="display:flex;gap:8px">
                <label style="flex:1">Expiry<input id="cardExp" placeholder="MM/YY"></label>
                <label style="flex:1">CVV<input id="cardCvv" placeholder="123"></label>
              </div>
            </div>
          </div>

          <div style="margin-top:12px">
            <button type="submit" class="btn">Place Order — Proceed to Pay</button>
          </div>
        </form>
      </div>
    </div>

    <aside>
      <div class="card">
        <h3>Order Summary</h3>
        <div class="totals">
          <div class="row"><div class="small muted">Subtotal</div><div id="subtotal">₹0</div></div>
          <div class="row"><div class="small muted">Tax (5%)</div><div id="tax">₹0</div></div>
          <div class="row"><div class="small muted">Shipping</div><div id="shipping">₹0</div></div>
          <hr>
          <div class="row" style="font-weight:900;font-size:18px"><div>Total</div><div id="grand">₹0</div></div>
        </div>
        <div style="margin-top:12px">
          <button class="btn" onclick="placeOrderDirect()">Proceed to Pay</button>
        </div>
      </div>
    </aside>
  </div>
</div>

<script>
const SHIPPING = 50;
const TAX_RATE = 0.05;

function readCart(){
  try{
    return JSON.parse(localStorage.getItem('cart') || '[]');
  }catch(e){ return [];}
}

function saveCart(cart){ localStorage.setItem('cart', JSON.stringify(cart)); renderCart(); }

function formatINR(n){ return '₹' + Number(n).toFixed(0); }

function renderCart(){
  const list = document.getElementById('cartList');
  const cart = readCart();
  if(!cart.length){ list.innerHTML = '<div style="padding:12px 0">Your cart is empty. <a href="products.html">Shop now</a></div>'; updateTotals(); return; }
  list.innerHTML = '';
  cart.forEach((it, idx)=>{
    const div = document.createElement('div');
    div.className = 'cart-item';
    div.innerHTML = `
      <img src="${it.img}" alt="${it.name}">
      <div style="flex:1">
        <div style="font-weight:800">${it.name}</div>
        <div class="muted">${it.desc}</div>
        <div style="margin-top:8px;display:flex;gap:8px;align-items:center">
          <div class="small muted">Qty</div>
          <input type="number" min="1" value="${it.qty}" style="width:70px;padding:6px;border-radius:8px;border:1px solid #eef6ff" onchange="updateQty(${idx},this.value)">
          <div style="margin-left:auto;font-weight:800">₹${it.price * it.qty}</div>
        </div>
      </div>
      <div style="margin-left:12px"><button class="secondary" onclick="removeItem(${idx})">Remove</button></div>
    `;
    list.appendChild(div);
  });
  updateTotals();
}

function updateQty(i, val){
  const cart = readCart();
  cart[i].qty = Math.max(1, parseInt(val)||1);
  saveCart(cart);
}

function removeItem(i){
  let cart = readCart(); cart.splice(i,1); saveCart(cart);
}

function updateTotals(){
  const cart = readCart();
  const subtotal = cart.reduce((s,it)=>s + (it.price * it.qty), 0);
  const tax = Math.round(subtotal * TAX_RATE);
  const shipping = cart.length ? SHIPPING : 0;
  const grand = subtotal + tax + shipping;
  document.getElementById('subtotal').textContent = formatINR(subtotal);
  document.getElementById('tax').textContent = formatINR(tax);
  document.getElementById('shipping').textContent = formatINR(shipping);
  document.getElementById('grand').textContent = formatINR(grand);
}

function continueShopping(){ window.location.href='products.html'; }
function clearCart(){ localStorage.removeItem('cart'); renderCart(); alert('Cart cleared'); }

function onPaymentChange(){
  const v = document.getElementById('paymentMethod').value;
  const container = document.getElementById('paymentFields');
  if(v==='card'){
    container.innerHTML = `<div id="cardFields"><label>Card Number<input id="cardNumber" placeholder="1234 1234 1234 1234"></label><div style="display:flex;gap:8px"><label style="flex:1">Expiry<input id="cardExp" placeholder="MM/YY"></label><label style="flex:1">CVV<input id="cardCvv" placeholder="123"></label></div></div>`;
  } else if(v==='upi'){
    container.innerHTML = `<label>UPI ID<input id="upiId" placeholder="name@bank"></label>`;
  } else {
    container.innerHTML = `<div class="small muted">You will be redirected to PayPal to complete payment.</div>`;
  }
}

function placeOrderDirect(){
  // same as submit; gather minimal info and redirect to thankyou
  document.getElementById('orderForm').requestSubmit();
}

function placeOrder(e){
  if(e) e.preventDefault();
  const cart = readCart();
  if(!cart.length){ alert('Cart is empty'); return; }
  const form = {
    name: document.getElementById('name').value.trim(),
    email: document.getElementById('email').value.trim(),
    phone: document.getElementById('phone').value.trim(),
    address: document.getElementById('address').value.trim(),
    city: document.getElementById('city').value.trim(),
    state: document.getElementById('state').value.trim(),
    zip: document.getElementById('zip').value.trim(),
    paymentMethod: document.getElementById('paymentMethod').value,
    coupon: document.getElementById('coupon').value.trim()
  };
  // compute totals
  const subtotal = cart.reduce((s,it)=>s + (it.price * it.qty), 0);
  const tax = Math.round(subtotal * TAX_RATE);
  const shipping = cart.length ? SHIPPING : 0;
  const grand = subtotal + tax + shipping;

  // create order object
  const order = {
    id: 'LS' + Date.now(),
    items: cart,
    subtotal, tax, shipping, grand,
    customer: form,
    createdAt: new Date().toISOString()
  };

  // store last order, clear cart
  localStorage.setItem('lastOrder', JSON.stringify(order));
  localStorage.removeItem('cart');

  // simulate payment processing then redirect
  window.location.href = 'thankyou.html';
}

// Initial render
onPaymentChange();
renderCart();
</script>
</body>
</html>
